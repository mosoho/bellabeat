xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip() +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill="#69b3a2")
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 6, color = "black") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
# Identify how many users get recommended amount of 7+ minutes of sleep
daily_users_sleep <- subset(daily_merged, !is.na(TotalMinutesAsleep)) %>%
group_by(Id) %>%
summarise(Count = n(), AverageMinutes = mean(TotalMinutesAsleep)) %>%
mutate(AverageHours = AverageMinutes/60)
#-> Prepare Id for GGplot
daily_users_sleep <- daily_users_sleep %>%
mutate(Id = fct_reorder(as.character(Id), AverageHours))
#-> GGPlot Line Bars with threshold of 7 hours
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours)) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours)) +
geom_point(size = 4, color = "orange") +
theme_minimal() +
xlab("") +
ylab("") +
coord_flip()
#->GGPlot with area starting at 7 hours
#--> Create df of area
rect <- data.frame(xmin=-Inf, xmax=Inf, ymin=7, ymax=Inf)
#-> GGplot with improved text label
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip() +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill="#69b3a2",
alpha = 0.5) +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill=NA,
alpha = 1)
#-> GGplot with improved text label
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip() +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill="#69b3a2",
alpha = 0.2) +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill=NA,
alpha = 1)
#-> GGplot with improved text label
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip() +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill="#69b3a2",
alpha = 0.2) +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill=NA,
alpha = .7)
#-> GGplot with improved text label
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip() +
geom_label(label="Healthy", x = 1.2, y = 9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35, color = "black", fill="#69b3a2", alpha = 0.2) +
geom_label(label="Healthy", x = 1.2, y = 9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35, color = "black", fill=NA, alpha = 1)
#-> GGplot with text-label
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip() +
geom_label(
label="Healthy",
x=1.2,
y=9.3,
label.padding = unit(0.55, "lines"), # Rectangle size around label
label.size = 0.35,
color = "black",
fill="#69b3a2")
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 6, color = "black") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 6, color = "black") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 6, color = "#60bbc3") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9, color = "#60bbc3") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Count >8)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
View(daily_users_sleep)
View(daily_users_sleep)
#-> Prepare table for GGplot: Fix Id type + indicate low quality
daily_users_sleep <- daily_users_sleep %>%
mutate(Id = fct_reorder(as.character(Id), AverageHours)) %>%
mutate(Quality = case_when(
Count >8 ~ "9 to 31 Days",
Count <=8 ~ "1 to 8 Days"
))
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Quality)) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Quality)) +
scale_color_manual(values = cbPalette)
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Quality)) +
scale_color_manual(values = cbPalette) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Quality)) +
scale_color_manual(values = c("grey", "orange")) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Quality)) +
scale_color_manual(values = cbPalette) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "> 8 Days")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
#--> GGplot
daily_users_sleep %>%
ggplot(aes(x = Id, y = AverageHours, color = Quality)) +
scale_color_manual(values = cbPalette) +
geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
fill="#05C4BC",
color="white",
alpha=0.2,
inherit.aes = FALSE) +
geom_segment(aes(x=Id, xend=Id, y=0,
yend=AverageHours), size = 1.5) +
geom_point(size = 4, color = "grey") +
theme_minimal() +
xlab("") +
ylab("Hours") +
guides(color = guide_legend(title = "Data available")) +
geom_hline(yintercept = 7, linetype = "dashed", size = 1, color = "#05C4BC") +
annotate("text", x = 1.2, y = 9.3, label = "Healthy", size = 9,
color = "#60bbc3", fontface = "bold") +
scale_y_continuous(breaks = c(0, 3, 6, 7, 9, 11),
labels = c(0, 3, 6, 7, 9, 11)) +
coord_flip()
View(daily_merged)
View(minute_merged)
# Clean up
rm(daily_users_sleep, rect)
# Loading all existing files after each other as a start up process
# Prepare + Process -------------------------------------------------------
source("code/2_prepare/1_CSV load.R")
install.packages(c("cli", "dplyr", "rlang", "tibble", "vctrs"))
# Loading all existing files after each other as a start up process
# Prepare + Process -------------------------------------------------------
source("code/2_prepare/1_CSV load.R")
# source("code/2_prepare/2_Identify data structures.R") ## Skipping as it's not creating or changing tables
source("code/3_process/1_Fix DATE issues.R")
source("code/3_process/2_Corelation.R")
source("code/3_process/3_Wide vs Long.R")
source("code/3_process/4_Reformat_minute_sleep.R")
# Analyze -----------------------------------------------------------------
source("code/4_analyze/2_plots_daily_sleep_day.R")
source("code/4_analyze/1_prep_merge_and_order.R")
source("code/4_analyze/1_prep_remove_duplicates.R")
# Plots - should not be needed for loading
# source("code/4_analyze/2_plots_daily_merged.R")
# source("code/4_analyze/2_plots_hourly_merged.R")
# source("code/4_analyze/2_plots_minute_merged.R")
# source("code/4_analyze/2_plots_weight_log_info.R")
install.packages("installr")
library(installr)
updateR()
